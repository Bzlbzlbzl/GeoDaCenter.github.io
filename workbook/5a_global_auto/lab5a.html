<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Luc Anselin" />

<meta name="date" content="2017-10-24" />

<title>Global Spatial Autocorrelation (1)</title>

<link href="lab5a_files/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="lab5a_files/highlightjs-1.1/highlight.js"></script>
    <title>GeoDa on Github</title>

    <style>
    	*{margin:0;padding:0;}
	.shadowfilter {
	-webkit-filter: drop-shadow(12px 12px 7px rgba(0,0,0,0.5));
	filter: url(shadow.svg#drop-shadow);
	}
	.intro1 { margin-left: -45px;}
    </style>
    <link rel="stylesheet" type="text/css" href="/stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" href="../../stylesheets/simple-slideshow-styles.css">
    <style>
    ul {padding-left:30px;} 
	figcaption {
	  top: .70em;
   	  left: .35em;
 	  bottom: auto!important;
	  right: auto!important;
	}
    </style>
    
        <style>
    h1 {
        text-align: center;
    }
    h3.subtitle{
        text-align: center;
    }
    h4.author {
        text-align: center;
    }
    h4.date {
        text-align: center;
    }
    p.caption {
        font-size : 12px;
    }
    </style>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72724100-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-53RVF8"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-53RVF8');</script>
<!-- End Google Tag Manager -->

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>





</head>

<body>


    <section class="page-header">
      <h1 class="project-name">GeoDa</h1>
      <h2 class="project-tagline">An Introduction to Spatial Data Analysis</h2>
      <a href="http://geodacenter.github.io/download.html" class="btn">Download</a>
      <a href="https://github.com/GeoDaCenter/geoda/" class="btn">View on GitHub</a>
      <a href="https://spatial.uchicago.edu/sample-data"  target="_blank" class="btn">Data</a>
       <a href="http://geodacenter.github.io/documentation.html" class="btn">Documentation</a>
       <a href="http://geodacenter.github.io/support.html" class="btn">Support</a>
       <a href="http://geodacenter.github.io/index-cn.html" class="btn">中文</a>
    </section>


    <section class="main-content">


<h1 class="title toc-ignore">Global Spatial Autocorrelation (1)</h1>
<h3 class="subtitle"><em>Moran Scatter Plot and Correlogram</em></h3>
<h4 class="author"><em>Luc Anselin<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></em></h4>
<h4 class="date"><em>10/24/2017</em></h4>


<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#objectives">Objectives</a><ul>
<li><a href="#geoda-functions-covered">GeoDa functions covered</a></li>
</ul></li>
<li><a href="#getting-started">Getting started</a></li>
</ul></li>
<li><a href="#the-moran-scatter-plot">The Moran Scatter PLot</a><ul>
<li><a href="#basics">Basics</a><ul>
<li><a href="#concepts">Concepts</a></li>
<li><a href="#interpretation">Interpretation</a></li>
<li><a href="#saving-scatter-plot-variables">Saving scatter plot variables</a></li>
</ul></li>
<li><a href="#permutation-inference">Permutation inference</a><ul>
<li><a href="#random-seed">Random seed</a></li>
<li><a href="#reference-distribution">Reference distribution</a></li>
</ul></li>
<li><a href="#lowess-smoother">LOWESS smoother</a></li>
<li><a href="#brushing-the-moran-scatter-plot">Brushing the Moran scatter plot</a></li>
</ul></li>
<li><a href="#spatial-correlogram">Spatial Correlogram</a><ul>
<li><a href="#distance-settings">Distance settings</a></li>
<li><a href="#larger-data-issues-random-sampling">Large(r) data issues – random sampling</a></li>
</ul></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<p><br></p>
<div id="introduction" class="section level2 unnumbered">
<h2>Introduction</h2>
<p>In this lab, we will explore the analysis of global spatial autocorrelation measures, focusing on the basics. We will use the Moran scatter plot and the non-parametric spatial correlogram to visualize the magnitude and the range of spatial autocorrelation. We will continue with the Cleveland house sales data set that we used in the analysis of distance-based spatial weights.</p>
<div id="objectives" class="section level3 unnumbered">
<h3>Objectives</h3>
<ul>
<li><p>Visualize Moran’s I by means of the Moran scatter plot</p></li>
<li><p>Carry out inference using the permutation approach</p></li>
<li><p>Make analyses replicable using the random seed setting</p></li>
<li><p>Nonlinear LOWESS smooth of the Moran scatter plot</p></li>
<li><p>Brushed Moran scatter plot to assess regional Moran’s I</p></li>
<li><p>Appreciate the difference between dynamic weights and static weights in Moran scatter plot regime regression</p></li>
<li><p>Analyze the range of spatial autocorrelation by means of a spatial correlogram</p></li>
<li><p>Address the sensitivity of the spatial correlogram to the choice of maximum distance and number of bins</p></li>
<li><p>Address the computation of the spatial correlogram for large(r) data sets by relying on random sampling</p></li>
</ul>
<div id="geoda-functions-covered" class="section level4 unnumbered">
<h4>GeoDa functions covered</h4>
<ul>
<li>Space &gt; Univariate Moran’s I
<ul>
<li>permutation inference</li>
<li>setting the random seed</li>
<li>LOWESS smoother of the Moran scatter plot</li>
<li>brushing the Moran scatter plot</li>
<li>save results (standardized value and spatial lag)</li>
</ul></li>
<li>Space &gt; Nonparametric Spatial Autocorrelation
<ul>
<li>variable selection</li>
<li>selecting the number of bins</li>
<li>selecting the maximum distance</li>
<li>using a random sample of locations</li>
</ul></li>
</ul>
<p><br></p>
</div>
</div>
<div id="getting-started" class="section level3 unnumbered">
<h3>Getting started</h3>
<p>With GeoDa launched and all previous projects closed, we load the project file for the Cleveland house price data, <strong>clev_sls_154_core.gda</strong>. This should bring up the themeless point map for the house sales locations.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/0_419_clevbasemap.png" alt="Cleveland sales themeless map" width="80%" />
<p class="caption">
Cleveland sales themeless map
</p>
</div>
<p>Without the project file, at least the contiguity weights based on the Thiessen polygons should be computed (previously <strong>clev_sls_154_core_q</strong>). If the project file was loaded successfully, then the weights manager will contain all four weights that were created previously. The queen contiguity weights (from the Thiessen polygons) should be selected, as shown in the figure below.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/0_420_weightsmanager.png" alt="Weights manager contents" width="40%" />
<p class="caption">
Weights manager contents
</p>
</div>
<p>We will use this weights file in the spatial autocorrelation analysis that follows.</p>
</div>
</div>
<div id="the-moran-scatter-plot" class="section level2 unnumbered">
<h2>The Moran Scatter PLot</h2>
<p>To start the Moran scatter plot, select the associated toolbar button, i.e., the left-most button in the spatial analysis group.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/0_421_morscat_icon.png" alt="Moran scatter plot toolbar icon" width="20%" />
<p class="caption">
Moran scatter plot toolbar icon
</p>
</div>
<p>After selecting the toolbar icon, the next prompt is for the type of analysis. For now, we will stick to the <strong>Univariate Moran’s I</strong> option.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/0_422_univariatemoranoption.png" alt="Univariate Moran's I" width="30%" />
<p class="caption">
Univariate Moran’s I
</p>
</div>
<p>Alternatively, one can choose <strong>Space &gt; Univariate Moran’s I</strong> from the menu.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/0_425_moranfrommenu.png" alt="Moran scatter plot from menu" width="40%" />
<p class="caption">
Moran scatter plot from menu
</p>
</div>
<div id="basics" class="section level3 unnumbered">
<h3>Basics</h3>
<p>After the univariate Moran’s I analysis is initiated, the next prompt is for the variable, to be selected from the <strong>Variable Settings</strong> dialog. In our example, we take <strong>sale_price</strong>. Note how the <strong>Weights</strong> drop down list shows the currently active weights. In our example, this should be <strong>clev_sls_154_core_q</strong>.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/1_423_variable.png" alt="Moran's I variable selection" width="40%" />
<p class="caption">
Moran’s I variable selection
</p>
</div>
<p>Clicking <strong>OK</strong> brings up the Moran scatter plot.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/1_424_moranscat.png" alt="Moran scatter plot" width="80%" />
<p class="caption">
Moran scatter plot
</p>
</div>
<div id="concepts" class="section level4 unnumbered">
<h4>Concepts</h4>
<p>The Moran scatter plot, first outlined in <span class="citation">Anselin (1996)</span>, consists of a plot with the spatially lagged variable on the y-axis and the original variable on the x-axis. Moran’s I equals the slope of the linear fit.</p>
<p>Moran’s I statistic is arguably the most used indicator of global spatial autocorrelation. It was suggested by <span class="citation">Moran (1948)</span> and popularized through the classic work on spatial autocorrelation by <span class="citation">Cliff and Ord (1973)</span>. In essence, it is a cross-product statistic between a variable and its spatial lag, with the variable expressed in deviations from its mean, i.e., for observation at location <span class="math inline">\(i\)</span>, <span class="math inline">\(z_i = x_i - \bar{x}\)</span>, where <span class="math inline">\(\bar{x}\)</span> is the mean of variable <span class="math inline">\(x\)</span>. Moran’s I statistic is then: <span class="math display">\[I = \frac{\sum_i\sum_j w_{ij} z_i.z_j /S_0}{\sum_i z_i^2 / N} \]</span> with <span class="math inline">\(w_{ij}\)</span> as the elements of the spatial weights matrix, <span class="math inline">\(S_0 = \sum_i \sum_j w_{ij}\)</span> as the sum of all the weights, and <span class="math inline">\(N\)</span> as the number of observations. For the variable <span class="math inline">\(z\)</span>, with row-standardized weights (and hence <span class="math inline">\(S_0 = N\)</span>), this is nothing but the slope of a regression of <span class="math inline">\(\sum_j w_{ij}z_j\)</span> on <span class="math inline">\(z_i\)</span>. This is the principle underlying the Moran scatter plot.</p>
</div>
<div id="interpretation" class="section level4 unnumbered">
<h4>Interpretation</h4>
<p>In our example, the points in the graph are a bit lopsided because it is rendered as a square (the preferred approach when both axes are measured in the same units, to avoid distorting the data). The house prices are on the horizontal axis, and their spatially lagged counterparts on the vertical axis. Note that the house price values have been standardized, and are given in standard deviational units (the mean is zero and the standard deviation is one). Similarly, the spatial lag is computed for those standardized values.</p>
<p>We can see that the shape of the point cloud is determined by the presence of several outliers on the high end (e.g., larger than three standard deviational units from the mean). One observation, with a sales price of $527,409 (compared to the median sales prices of $20,000), is as large as 8 standard deviational units above the mean. On the lower end of the spectrum (to the left of the dashed line in the middle that represents the mean), there is much less spread in the house prices, and those points end up bunched together. By eliminating some of the outliers, one may be able to see more detail for the remaining observations, but we won’t pursue that here.</p>
<p>In its default setting, the plot shows a linear fit through the point cloud. The slope of this line corresponds to Moran’s I, and its value (0.282336) is listed at the top of the graph.</p>
<p>In the usual way, a right click in the plot brings up the available options.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/1_426_scatplotoptions.png" alt="Moran scatter plot options" width="25%" />
<p class="caption">
Moran scatter plot options
</p>
</div>
<p>Many of these are by now familiar. We consider three more closely: <strong>View</strong>, <strong>Randomization</strong> and <strong>Save Results</strong>. We start with the latter.</p>
</div>
<div id="saving-scatter-plot-variables" class="section level4 unnumbered">
<h4>Saving scatter plot variables</h4>
<p>When selecting the <strong>Save Results</strong> option, the dialog offers suggested variable names for the standardized variable (recall that the variable specified was <strong>sale_price</strong>, not its standardized version), with default name <strong>MORAN_STD</strong>, and for its spatial lag, with default name <strong>MORAN_LAG</strong>. A click on <strong>OK</strong> will add these two variables to the data table.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/1_427_save_vars.png" alt="Saving variables from Moran scatter plot" width="40%" />
<p class="caption">
Saving variables from Moran scatter plot
</p>
</div>
<p>We can quickly verify these variables by using the <strong>Table &gt; Calculator</strong> option to compute a standardized version of <strong>sale_price</strong> and its spatial lag. For the former, we use the <strong>Univariate</strong> tab and the <strong>STANDARDIZED</strong> operator (we first add <strong>M_ST</strong> as a new variable).</p>
<div class="figure" style="text-align: center">
<img src="pics5a/1_428_standardize.png" alt="Standardized variable in calculator" width="80%" />
<p class="caption">
Standardized variable in calculator
</p>
</div>
<p>For the spatial lag, we use the <strong>Spatial Lag</strong> tab, with the weights file <strong>clev_sls_154_core_q</strong> specified and the previously standardized variable (again, after adding <strong>M_LAG</strong> as the new variable).</p>
<div class="figure" style="text-align: center">
<img src="pics5a/1_429_lag.png" alt="Spatially lagged variable in calculator" width="80%" />
<p class="caption">
Spatially lagged variable in calculator
</p>
</div>
<p>The table now has four extra columns, two generated by the Moran scatter plot option, and two calculated explicitly to replicate these results.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/1_433_lagintable.png" alt="Variables added to table" width="60%" />
<p class="caption">
Variables added to table
</p>
</div>
<p>We can now construct a Moran scatter plot <em>the hard way</em>, by creating a standard scatter plot, with <strong>MORAN_STD</strong> on the x-axis and <strong>MORAN_LAG</strong> on the y-axis (or, alternatively, <strong>M_ST</strong> and <strong>M_LAG</strong>).</p>
<div class="figure" style="text-align: center">
<img src="pics5a/1_434_morscat_as_scatplot.png" alt="Scatter plot with spatial variables" width="40%" />
<p class="caption">
Scatter plot with spatial variables
</p>
</div>
<p>This yields the standard scatter plot. In contrast to the Moran scatter plot, the statistics are displayed below the plot (the default setting for a standard scatter plot). This reveals the slope of the linear fit to be <strong>0.282</strong>, the same as Moran’s I given by the Moran scatter plot.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/1_435_morscat2.png" alt="Moran as a standard scatter plot" width="80%" />
<p class="caption">
Moran as a standard scatter plot
</p>
</div>
<p>We will revisit this plot later when we consider the difference between <strong>regime regression</strong> in the Moran scatter plot compared to the standard scatter plot.</p>
</div>
</div>
<div id="permutation-inference" class="section level3 unnumbered">
<h3>Permutation inference</h3>
<p>In order to carry out inference for the Moran’s I statistic, GeoDa implements a randomization or permutation approach. This builds a reference distribution for the statistic under the null hypothesis of spatial randomness by randomly reshuffling the values over locations and recomputing the statistic each time.</p>
<p>The <strong>Randomization</strong> options starts this process. We select the number of permutations in the side panel (typically 99, 999, etc., to yield nicely rounded pseudo p-values).</p>
<div class="figure" style="text-align: center">
<img src="pics5a/2_436_randomization.png" alt="Randomization inference" width="40%" />
<p class="caption">
Randomization inference
</p>
</div>
<p>In our example, we select <strong>999 Permutations</strong>, which is typically sufficient for reliable inference. The most <em>extreme</em> pseudo p-value possible under this scenario is 0.001, which means that none of the permuted data sets yielded a statistic larger than the one observed in the actual data set.</p>
<div id="random-seed" class="section level4 unnumbered">
<h4>Random seed</h4>
<p>In order to facilitate replication, the default setting in GeoDa is to use a specified seed for the random number generator (evidenced by the check mark next to <strong>Use Specified Seed</strong>). The default seed is shown in the <strong>Specify Seed …</strong> box, where it can be changed.</p>
<p>The random seed is set globally in the GeoDa <strong>Preferences</strong>, under the <strong>System</strong> tab. At the bottom of the dialog, the box for using the specified seed is checked by default and the values 123456789 is used as the default seed. This can be changed by typing in a different value. The same seed is used in all operations in GeoDa that rely on random permutations (i.e., all flavors of the Moran scatter plot, and all the local spatial autocorrelation statistics). This ensures that the results will be identical for each analysis that uses the same sequence of random numbers.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/2_438_seed_option.png" alt="Random seed in GeoDa preferences" width="80%" />
<p class="caption">
Random seed in GeoDa preferences
</p>
</div>
</div>
<div id="reference-distribution" class="section level4 unnumbered">
<h4>Reference distribution</h4>
<p>The result of the randomization (or permutation) operation is a reference distribution for the statistic, depicted as a histogram. The green line shows the value of the statistic for the actual data, placed at 0.2823 in our example, well to the right of the reference distribution, suggesting a strong rejection of the null hypothesis.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/2_437_permutation.png" alt="Reference distribution for Moran's I" width="60%" />
<p class="caption">
Reference distribution for Moran’s I
</p>
</div>
<p>The graph contains several summary statistics. In the top left are shown the number of permutations used to construct the reference distribution (999) and the associated pseudo p-value. The latter is the ratio of the number of values for the statistic that are equal to or greater than the observed value (in our example, just 1 for the observed statistic itself) to the number of generated samples (999) + 1 (for the actual sample). Hence, the result is 1/(999+1) = 0.001. As mentioned above, this is also the smallest (most extreme) p-value that can be obtained. It is important to keep this in mind when comparing results where a different number of permutations are used. For example, a pseudo p-value of 0.001 for 999 permutations is not necessarily <em>more significant</em> than a pseudo p-value of 0.01 for 99. In both cases, not a single statistic computed from the randomly generated samples exceeded the actual statistic. This contrasts with the usual interpretation of an analytically derived p-value.</p>
<p>In the status bar at the bottom of the graph appear several descriptive measures of the Moran’s I statistic. First is the actually observed value, I = 0.2823. Next follows the theoretical expected value, E[I], which equals -1/(n-1). The value of -0.0049 is indeed -1 / 204 (there are 205 observations in the data set). The mean is the average of the reference distribution. In our example, this result is -0.0071, slightly off from the theoretically expected value. The standard deviation of the reference distribution is 0.0372, compared to a theoretical value of 0.00158 under an analytical randomization approach (not computed in GeoDa). This illustrates a common feature in empirical work, namely that the theoretical indication of precision may be overly optimistic (the standard deviation is smaller in the analytical derivation). The z-value that corresponds to the computed Moran’s I, its empirical mean and standard deviation is 7.7721 (the last item to the right on the status bar). Even though a normal approximation would not be accurate, the z-value does suggest strong rejection of the null hypothesis.</p>
<p>Clicking on the <strong>Run</strong> button will generate a new empirical distribution. This allows for a sensitivity analysis of the results. Especially when only 99 permutations are used, the summary statistics may vary somewhat, but for 999 (and definitely for 99999, the largest possible value), they should be pretty stable.</p>
</div>
</div>
<div id="lowess-smoother" class="section level3 unnumbered">
<h3>LOWESS smoother</h3>
<p>In addition to the traditional linear smoother, GeoDa also supports a Lowess smoother of the Moran scatter plot (this is similar to the functionality in the standard scatter plot). This is accomplished by selecting the <strong>View &gt; LOWESS Smoother</strong> item in the options menu.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/3_439_lowess_option.png" alt="LOWESS option" width="60%" />
<p class="caption">
LOWESS option
</p>
</div>
<p>With the <strong>View &gt; Linear Smoother</strong> option turned off, the nonlinear fit from the local regression is shown on the Moran scatter plot. The Lowess smoother can be explored to identify potential structural breaks in the pattern of spatial autocorrelation. For example, in some parts of the data set, the curve may be very steep and positive, suggesting strong positive spatial autocorrelation, whereas in other parts, it could be flat, indicating no autocorrelation.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/3_440_scat_lowess.png" alt="LOWESS smooth of Moran scatter plot" width="80%" />
<p class="caption">
LOWESS smooth of Moran scatter plot
</p>
</div>
<p>The local smoother is fit through the points in the Moran scatter plot by utilizing only those observations within a given bandwidth. The default is to use 0.20 of the range of values. The bandwidth (as well as other, more technical parameters) can be specified by selecting the <strong>View &gt; Edit LOWESS Parameters</strong> item in the options menu, as we have seen in the discussion of the standard scatter plot. All options work exactly the same as for that case.</p>
</div>
<div id="brushing-the-moran-scatter-plot" class="section level3 unnumbered">
<h3>Brushing the Moran scatter plot</h3>
<p>The final option of the <strong>View</strong> setting that we consider initiates <strong>Regimes Regression</strong>. As in the standard scatter plot, this recomputes the statistics as observations are selected. We proceed with the <strong>LOWESS Smoother</strong> turned off and the <strong>Regimes Regression</strong> selected, as shown below.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/3_441_regimes.png" alt="Moran scatter plot regimes" width="60%" />
<p class="caption">
Moran scatter plot regimes
</p>
</div>
<p>This brings up the initial setting for the brushing operation. There are now three Moran scatter plots. The one to the left (in red) is for the <strong>selected</strong> observations, currently empty, since no selection has been made. The one to the right is for the complement, referred to as <strong>unselected</strong> (in black), currently the same as the scatter plot in the center, which shows the slope for all observations.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/3_442_scat_regimes1.png" alt="Regimes starting setup" width="100%" />
<p class="caption">
Regimes starting setup
</p>
</div>
<p>We start the brushing operation by selecting a large rectangle with 51 observations (the number of selected observations is shown in the status bar) in the lower right of the point map. As soon as the selection is made, the red and black graphs are updated.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/3_443_regimes_select1.png" alt="Brushing the Moran scatter plot - 1" width="100%" />
<p class="caption">
Brushing the Moran scatter plot - 1
</p>
</div>
<p>The distinguishing characteristics of this brushing operation (or, any selection) is that the spatial weights are dynamically updated for both the selection and the unselected observations. In other words, the edge effects are corrected for and no links are included to locations that are not part of the selection. The same holds for the unselected observations. As a result, the slope of the Moran scatter plots on the left and the right are as if the data set consisted only of the points selected/unselected. This is a visual implementation of a <em>regionalized</em> Moran’s I, where the indicator of spatial autocorrelation is calculated for a subset of the observations <span class="citation">(Munasinghe and Morris 1996)</span>.</p>
<p>In our initial selection, the selected observations show no spatial autocorrelation at all (a value of 0.0257), whereas the complement (unselected) obtain a Moran’s I of 0.2801, basically the same as the overall statistic of 0.282. This would suggest the presence of spatial heterogeneity in the strength of the spatial autocorrelation, in the sense that the subset selected shows a very different degree of dependence than its complement (or the data set as a whole). Note that this is purely exploratory, and there is no actual <em>test</em> for the difference between the two statistics (this contrasts with the availability of the Chow test in the standard scatter plot).</p>
<p>As we move the <em>brush</em> to the left in the point map, the selected and unselected scatter plots are updated in real time, showing the corresponding regional Moran’s I statistics.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/3_443_regimes_select2.png" alt="Brushing the Moran scatter plot - 2" width="100%" />
<p class="caption">
Brushing the Moran scatter plot - 2
</p>
</div>
<p>In our example, the second selection shows much less evidence of spatial heterogeneity, with a Moran’s I of 0.3208 for the selected observations and 0.3537 for the complement, as shown above.</p>
<p>Of course, because of the linking of all graphs in GeoDa, the selection is also reflected in the <em>standard</em> scatter plot we constructed for the standardized price variable and its spatial lag. The difference between this and the Moran scatter plot brushing pertains to the dynamically updated spatial weights. In the standard scatter plot, the spatially lagged variable is included in the selection as is, which includes its neighbors that are not part of the selection. The spatial lag pertains to all the observations, in contrast to the selection in the Moran scatter plot, which dynamically updates the spatial weights for both the selected and unselected.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/3_445_scatplotselect.png" alt="Brushing the standard scatter plot" width="80%" />
<p class="caption">
Brushing the standard scatter plot
</p>
</div>
<p>The scatter plot with the same 51 selected observations as in the first example above yields a slope of 0.170 for the selected (contrasted with 0.026 above) and 0.272 for the unselected (compared with 0.280 above). The usual Chow test does not provide strong evidence for spatial heterogeneity. This needs to be interpreted with caution, since the weights structure has not been adjusted to reflect the actual <em>breaks</em> within the data set. On the other hand, the standard scatter plot <em>ignores</em> boundary effects (in the sense that it includes neighbors <em>outside</em> the regimes), so in some contexts, this may be the interpretation sought. GeoDa provides both options.</p>
</div>
</div>
<div id="spatial-correlogram" class="section level2 unnumbered">
<h2>Spatial Correlogram</h2>
<p>A non-parametric correlogram is an alternative measure of global spatial autocorrelation that does not rely on the specification of a spatial weights matrix. Instead, a local regression is fit to the covariances or correlations computed for all pairs of observations as a function of the distance between them <span class="citation">(for example, as outlined in Bjornstad and Falck 2001)</span>. With standardized variables <span class="math inline">\(z\)</span>, this boils down to a local regression of <span class="math inline">\(z_i.z_j\)</span> on <span class="math inline">\(f(d_{ij})\)</span>, where <span class="math inline">\(f\)</span> is the non-parametric function to be determined from the data (a LOWESS or kernel regression).</p>
<p>GeoDa implements the correlogram (i.e., using a standardized variable such that the cross-products correspond to correlations) as a local regression computed for the average correlation for all pairs of observations in a distance bin. This uses a similar logic as underlying the empirical variogram of geostatistics, but with a non-linear smoother applied to the bin estimates.</p>
<p>This functionality is invoked by clicking on the corresponding icon in the toolbar (the middle icon in the spatial analysis group), or by selecting <strong>Space &gt; Nonparametric Spatial Autocorrelation</strong> from the menu (the item at the very bottom of the list of options).</p>
<div class="figure" style="text-align: center">
<img src="pics5a/5_462_correlogram_icon.png" alt="Non-parametric correlogram icon" width="30%" />
<p class="caption">
Non-parametric correlogram icon
</p>
</div>
<p>This brings up a dialog with the default parameter settings and a graph in the background. This graph is not informative at this point, since it shows a correlogram for the first variable, which is <strong>unique_id</strong>. First, we need to choose the proper settings in the dialog.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/5_463_initial_correlogram.png" alt="Initial correlogram dialog" width="50%" />
<p class="caption">
Initial correlogram dialog
</p>
</div>
<p>The items at the top of the dialog are the <strong>Variable</strong> (available from a drop down list), the <strong>Distance</strong> metric (default is Euclidean, but Arc distance is also available), and the <strong>Number of Bins</strong>. The non-parametric correlogram is computed by means of a local regression on the pairwise correlations that fall within a distance bin. The number of bins determines the distance range of each bin. This range is the maximum distance divided by the number of bins. The more bins are chosen, the more fine-grained the correlogram will be. However, this also potentially can lead to too few pairs in some bins (the rule of thumb is to have at least 30).</p>
<p>The number of elements in each bin is a result of the interplay between the number of bins and the maximum distance. As the default, all pairs are used (in our example, with 205 observations, this yields: <span class="math inline">\([205^2 - 205]/2 = 20910\)</span> pairs) and thus all the pairwise distances are taken into account. However, in many instances in practice, this may not be a good choice. For example, when there are many observations, the number of pairs quickly becomes unwieldy and GeoDa will run out of memory. Also, the correlations computed for pairs that are far apart are not that meaningful (they should be zero due to Tobler’s law). The bottom half of the dialog provides options for fine-tuning these choices.</p>
<p>First, we consider the default, which uses all pairs and does not impose any constraints in terms of maximum distance. The number of bins is set to <strong>10</strong>. As before, the <strong>Variable</strong> we analyze is <strong>sale_price</strong>.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/5_464_saleprice.png" alt="Variable setting for correlogram" width="30%" />
<p class="caption">
Variable setting for correlogram
</p>
</div>
<p>Clicking the <strong>Apply</strong> button yields the following spatial correlogram. Slight adjustments to the size of the window may be necessary in order to see all the detail on the horizontal axis, especially since the distances are expressed in feet (so they are large numbers).</p>
<div class="figure" style="text-align: center">
<img src="pics5a/5_465_default_correlogram.png" alt="Default spatial correlogram" width="80%" />
<p class="caption">
Default spatial correlogram
</p>
</div>
<p>At the top of the graph is the correlogram, depicting how the spatial autocorrelation changes with distance. Hovering the pointer over each blue dot, gives the spatial autocorrelation associated with that distance band in the status bar. In our example, the first dot corresponds to 0.202048 for distances between 0 and 4823 feet (or about 0.9 miles). The intersection between the correlogram and the dashed zero axis (which determines the range of spatial autocorrelation) happens in the midpoint of the second range (4823 to 9647 feet), i.e., 7235, or roughly around 1.4 miles. Beyond that range, the autocorrelation is first negative and then fluctuates around the zero line.</p>
<p>At the bottom of the graph is a histogram that shows the number of pairs of observations in each bin. Hovering the pointer over a given bin shows how many pairs are contained in the bin in the status bar. In our example, each bin clearly has more than sufficient observation pairs. Even the last bin, which seems small (a function of the vertical scale), uses 75 pairs for the computation.</p>
<p>Further detail is provided when selecting the <strong>Display Statistics</strong> option (right click on the graph). For each bin, the computed autocorrelation is provided, as well as the distance range for the bin (lower and upper bound), and the number of pairs used to compute the statistic. In addition, there is a summary with the minimum and maximum distance, the total number of pairs, and an estimate for the range (i.e., the distance at which the estimated autocorrelation first becomes zero). In our example, the latter is estimated to be about 7,225 feet (about 1.4 miles). Right after the listing of the value for the range, the lower and upper bound of the bin where the correlogram crosses the axis is given (this provides an alternative, but less precise approximation of the range).</p>
<div class="figure" style="text-align: center">
<img src="pics5a/5_466_correlogram_w_stats.png" alt="Spatial correlogram with statistics" width="80%" />
<p class="caption">
Spatial correlogram with statistics
</p>
</div>
<div id="distance-settings" class="section level3 unnumbered">
<h3>Distance settings</h3>
<p>In most situations, the default use of all the distance pairs is too overwhelming. Also, there is a good reason to limit the maximum distance, since correlations at large(r) distances are both sparser (fewer pairs in a bin, which leads to less precise estimates) and supposed to be near zero (Tobler’s law).</p>
<p>There are several rules of thumb to set the maximum distance. GeoDa uses half of the maximum distance as a point of departure. By checking the box next to <strong>Max Distance</strong> and clicking on the button in the middle of the slider bar, half the maximum distance (<strong>24131.4</strong>) is listed in the box. This reduces the number of pairs used to compute the correlations almost by half, from 20910 to roughly 10557.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></p>
<div class="figure" style="text-align: center">
<img src="pics5a/5_467_dist24131.png" alt="Adjusting maximum distance" width="30%" />
<p class="caption">
Adjusting maximum distance
</p>
</div>
<p>The corresponding correlogram emphasizes the autocorrelation pattern over the shorter distance ranges. It suggests a range for the correlation that is basically the same as the initial result, about 7,244 feet (compared to 7,225). The status bar lists the autocorrelation given by the point over which the pointer hovers (in our example, about -0.056 for the fourth bin).</p>
<div class="figure" style="text-align: center">
<img src="pics5a/5_468_corr_w_dist24.png" alt="Correlogram with half max distance" width="80%" />
<p class="caption">
Correlogram with half max distance
</p>
</div>
<p>In order to get an even more precise measure of the range, we can specify the maximum distance as 20000 feet (3.8 miles) by typing this value into the bin, and select 20 bins (there are plenty of observations, so there is no danger of having fewer than 30 pairs in any bin).</p>
<p>The resulting correlogram will have a distance range for each bin of 1000 feet (about 0.2 miles). This provides a much finer grained measure of the range of spatial autocorrelation (this may require some expansion of the window to clearly see all the values on the horizontal axis and the displayed statistics).</p>
<p>The intersection between the correlogram and the zero axis is almost exactly in the middle of the 6000-7000 foot range, about 6775 feet (or 1.3 miles). In sum, by changing the correlogram parameters from the default to a much smaller value and increasing the number of bins, the estimate of our range of spatial interaction goes from about 7200 feet to about 6800 feet. This highlights the importance of sensitivity analysis and going beyond the default values.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/5_469_20bins.png" alt="Custom distance and bins" width="80%" />
<p class="caption">
Custom distance and bins
</p>
</div>
</div>
<div id="larger-data-issues-random-sampling" class="section level3 unnumbered">
<h3>Large(r) data issues – random sampling</h3>
<p>A final feature of the correlogram in GeoDa is to compute the autocorrelations for a sample of locations, which reduces the number of pairs used in the calculations. This is especially useful when the data set is large, in which case the number of pairs could quickly become prohibitive. In our example, this is not really necessary, since the default sample size of 1,000,000 that is used to generate the random sample exceeds the current total number of pairs in the actual data. Nevertheless, to illustrate the process, we go back and use <strong>20000</strong> for the maximum distance, with 10 bins, and check the <strong>Random Sample</strong> radio button, with <strong>10000</strong> for the sample size, as shown below. To ensure replication, the random sample seed is set to the default specified in the <strong>Preferences</strong>, but it can be adjusted by clicking on the <strong>Change</strong> button. In our example, we keep the default as is.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/5_470_random.png" alt="Randomly sampled observation pairs" width="30%" />
<p class="caption">
Randomly sampled observation pairs
</p>
</div>
<p>In our example, the correlogram that results from the sampled observation pairs is not that different from the default case. The first correlation is higher, at 0.513, but the range is again roughly 7000 feet. In general, the sampling approximation is quite good, as long as the selected sample size is not too small relative to the original data size.</p>
<div class="figure" style="text-align: center">
<img src="pics5a/5_471_corr_w_random.png" alt="Correlogram for random observation pairs" width="80%" />
<p class="caption">
Correlogram for random observation pairs
</p>
</div>
<p><br></p>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-Anselin96">
<p>Anselin, Luc. 1996. “The Moran Scatterplot as an ESDA Tool to Assess Local Instability in Spatial Association.” In <em>Spatial Analytical Perspectives on GIS in Environmental and Socio-Economic Sciences</em>, by Manfred Fischer, Henk Scholten, and David Unwin (Eds.), 111–25. Taylor and Francis, London.</p>
</div>
<div id="ref-BjornstadFalck01">
<p>Bjornstad, Ottar N., and Wilhelm Falck. 2001. “Nonparametric Spatial Covariance Functions, Estimation and Testing.” <em>Environmental and Ecological Statistics</em> 8: 53–70.</p>
</div>
<div id="ref-CliffOrd73">
<p>Cliff, Andrew, and Keith Ord. 1973. <em>Spatial Autocorrelation</em>. Pion.</p>
</div>
<div id="ref-Moran48">
<p>Moran, Patrick A.P. 1948. “The Interpretation of Statistical Maps.” <em>Biometrika</em> 35: 255–60.</p>
</div>
<div id="ref-MunasingheMorris96">
<p>Munasinghe, Rajika, and Robert D. Morris. 1996. “Localization of Disease Clusters Using Regional Measures of Spatial Autocorrelation.” <em>Statistics in Medicine</em> 15: 893–905.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>University of Chicago, Center for Spatial Data Science – <a href="mailto:anselin@uchicago.edu">anselin@uchicago.edu</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Since the estimated number of pairs is computed on the fly, as the maximum distance is adjusted by means of the slider, it is only an approximation. The actual number of pairs used in the calcuation of the pairwise correlations is given in the status bar of the correlogram.<a href="#fnref2">↩</a></p></li>
</ol>
</div>

<footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/lixun910/geoda">GeoDa</a> is maintained by <a href="#">lixun910</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

      </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-72724100-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
